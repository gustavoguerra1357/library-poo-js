(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}})();class g{constructor(e,s,r,t,o){this.title=e,this.author=s,this.pages=r,this.image=t,this.stock=o,this.rents=[]}rent(e){return this.stock>0?(this.stock--,this.rents.push(e),!0):!1}removerAluguel(e){this.rents=this.rents.filter(s=>s!==e)}}class B{constructor(){this.books=[],this.rentedBooks=[]}addBook(e){this.books.push(e)}removeBook(e){const s=this.books.indexOf(e);s>-1&&this.books.splice(s,1)}getAllBooks(){return this.books}rentBook(e,s){if(!e)throw new Error("Livro não encontrado");if(!e.rent(s))throw new Error("Livro sem estoque");return this.rentedBooks.push([e,s]),e}getRentedBooks(){return this.rentedBooks}removerAluguel(e){const s=this.rentedBooks.find(r=>r[1]===e);if(s){const[r,t]=s;r.removerAluguel(t),r.stock+=1,this.rentedBooks=this.rentedBooks.filter(o=>o[1]!==e)}}}class q{constructor(e,s){this.name=e,this.date=new Date,this.devolucao=s}}const i=new B,S=document.querySelector("#newBtn"),E=document.querySelector("#btn-cancelar"),w=document.querySelector("#form-livro"),v=document.querySelector("#modal-newbook"),u=document.querySelector("#title"),m=document.querySelector("#author"),f=document.querySelector("#pages"),b=document.querySelector("#input-imagem"),h=document.querySelector("#stock");S.addEventListener("click",n=>{v.classList.remove("hidden")});E.addEventListener("click",n=>{v.classList.add("hidden")});w.addEventListener("submit",n=>{n.preventDefault();const e=u.value,s=m.value,r=Number(f.value),t=Number(h.value),o=b.files[0],c=new FileReader;c.onload=function(l){const k=l.target.result,L=new g(e,s,r,k,t);i.addBook(L),y(),u.value="",m.value="",f.value="",h.value=""},o&&c.readAsDataURL(o)});function y(){const n=document.querySelector("#list-books");n.innerHTML="",i.getAllBooks().forEach(s=>{T(s,n)})}function T(n,e){const s=document.createElement("div"),r=document.createElement("img");r.src=n.image;const t=document.createElement("h2"),o=document.createElement("h3"),c=document.createElement("p");t.innerText=n.title,o.innerText=n.author,c.innerText="Em Estoque: "+n.stock,s.addEventListener("click",l=>{l.stopPropagation(),A(n)}),s.append(r,t,o,c),e.appendChild(s)}function A(n){d();const e=document.querySelector("#modal-infoBook"),s=document.querySelector("#close-info");s.onclick=()=>{e.classList.add("hidden"),d()},a(n);const r=document.querySelector("#rent-btn");r.onclick=()=>{const t=document.querySelector("#name-input").value,o=document.querySelector("#date-input").valueAsDate;if(o!=null){const c=new q(t,o);i.rentBook(n,c),a(n),p(n)}},p(n),e.classList.remove("hidden")}function p(n){const e=document.querySelector("#rents-container");e.innerHTML="",n.rents.forEach(r=>{const t=document.createElement("div"),o=document.createElement("button");o.innerText="X",o.classList.add("close-button-rents"),o.addEventListener("click",()=>{t.remove(),n.removerAluguel(r),i.removerAluguel(r),a(n)});const c=new Intl.DateTimeFormat("pt-BR").format(r.devolucao);t.innerHTML="<div class='info-rent'><span>Nome: "+r.name+"</span><span> Data de Devolução: "+c+"</span></div>",t.appendChild(o),e.appendChild(t)})}function a(n){document.querySelector("#image-book").src=n.image,document.querySelector("#title-book").innerText="Titulo: "+n.title,document.querySelector("#author-book").innerText="Autor: "+n.author,document.querySelector("#pages-book").innerText="Páginas: "+n.pages,document.querySelector("#stock-book").innerText="Em Estoque: "+n.stock}document.querySelector("#rentsBtn").addEventListener("click",n=>{const e=document.querySelector("#modal-rents");document.querySelector("#rentsbook-list").innerHTML="",e.classList.contains("hidden")&&(d(),e.classList.remove("hidden")),i.getRentedBooks().forEach(r=>{const t=document.createElement("div"),o=document.createElement("button");o.innerText="X",o.classList.add("close-button-rents"),o.addEventListener("click",()=>{t.remove(),i.removerAluguel(r[1])});const c=new Intl.DateTimeFormat("pt-BR").format(r[1].devolucao);t.innerHTML="<div class='info-rent'><span>Livro: "+r[0].title+"</span><span>Pego por: "+r[1].name+"</span><span> Data de Devolução: "+c+"</span></div>",t.classList.add("rents"),t.appendChild(o),document.querySelector("#rentsbook-list").appendChild(t)})});document.querySelector("#close-rents").addEventListener("click",n=>{document.querySelector("#modal-rents").classList.add("hidden"),d()});function d(){document.querySelector("#modal-overlay").classList.toggle("hidden"),document.body.style.overflow=="hidden"?document.body.style.overflow="":document.body.style.overflow="hidden"}document.querySelector("#deleteBtn").addEventListener("click",n=>{const e=document.querySelector("#listbook-delete"),s=document.querySelector("#modal-delete"),r=i.getAllBooks();e.innerHTML="",s.classList.contains("hidden")&&(d(),s.classList.remove("hidden")),r.forEach(t=>{const o=document.createElement("div"),c=document.createElement("button");c.innerText="X",c.classList.add("close-button-rents"),c.addEventListener("click",()=>{o.remove(),i.removeBook(t),y()}),o.innerHTML="<div class='info-rent'><span>Livro: "+t.title+" </span></div>",o.classList.add("rents"),o.appendChild(c),e.appendChild(o)})});document.querySelector("#close-delete").addEventListener("click",n=>{document.querySelector("#modal-delete").classList.add("hidden"),d()});
